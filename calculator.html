<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>AndorraOS – Calculadora Fiscal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="page">
    <div class="page-inner">

      <section class="left">
        <div class="left-inner">

          <div class="logo-row">
            <div class="logo-main">
              <div class="logo-icon"><span>AO</span></div>
              <div class="logo-text">
                <div class="logo-title">ANDORRAOS</div>
                <div class="logo-subtitle">CALCULADORA FISCAL</div>
              </div>
            </div>
          </div>

          <div class="title-block">
            <div class="title-main">
              Simulación fiscal<br />
              <span>España vs Andorra</span>
            </div>
            <div class="title-sub">
              Introduce tus datos y obtén un análisis detallado.
            </div>
          </div>

          <form id="calc-form">

            <label>Ingresos anuales (€)</label>
            <input type="number" id="ingresos" required />

            <label>País actual</label>
            <select id="pais" required>
              <option value="espana">España</option>
              <option value="otro">Otro</option>
            </select>

            <label>Estructura</label>
            <select id="estructura" required>
              <option value="autonomo">Autónomo</option>
              <option value="empresa">Empresa</option>
            </select>

            <label>Parroquia en Andorra</label>
            <select id="parroquia" required>
              <option value="andorra-la-vella">Andorra la Vella</option>
              <option value="escaldes-engordany">Escaldes-Engordany</option>
              <option value="encamp">Encamp</option>
              <option value="la-massana">La Massana</option>
              <option value="ordino">Ordino</option>
              <option value="canillo">Canillo</option>
              <option value="sant-julia">Sant Julià de Lòria</option>
            </select>

            <label>Email</label>
            <input type="email" id="email" required />

            <button type="submit" class="btn-primary">
              <span class="icon">➜</span>
              <span>Calcular</span>
            </button>

          </form>

          <div id="resultados" class="resultados"></div>

          <button id="btn-pdf" class="btn-secondary" style="display:none;">
            Descargar informe PDF
          </button>

        </div>
      </section>

    </div>
  </div>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    // Precargar email
    const storedEmail = localStorage.getItem('andorraos_email');
    if (storedEmail) {
      document.getElementById('email').value = storedEmail;
    }

    // Cálculo simple
    document.getElementById('calc-form').addEventListener('submit', function(e) {
      e.preventDefault();

      const ingresos = parseFloat(document.getElementById('ingresos').value);
      const estructura = document.getElementById('estructura').value;

      let irpfEsp = ingresos * 0.30;
      let irpfAnd = ingresos <= 24000 ? 0 : (ingresos - 24000) * 0.05;

      const ahorro = irpfEsp - irpfAnd;

      document.getElementById('resultados').innerHTML = `
        <h3>Resultados</h3>
        <p><strong>IRPF España:</strong> ${irpfEsp.toFixed(2)} €</p>
        <p><strong>IRPF Andorra:</strong> ${irpfAnd.toFixed(2)} €</p>
        <p><strong>Ahorro estimado:</strong> ${ahorro.toFixed(2)} €</p>
      `;

      document.getElementById('btn-pdf').style.display = 'block';
    });

    // PDF
    document.getElementById('btn-pdf').addEventListener('click', () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(18);
      doc.text('Informe Fiscal AndorraOS', 10, 20);

      doc.setFontSize(12);
      doc.text(`Ingresos: ${document.getElementById('ingresos').value} €`, 10, 40);
      doc.text(`Estructura: ${document.getElementById('estructura').value}`, 10, 50);
      doc.text(`Email: ${document.getElementById('email').value}`, 10, 60);

      const res = document.getElementById('resultados').innerText.split('\n');
      let y = 80;
      res.forEach(line => {
        doc.text(line, 10, y);
        y += 10;
      });

      doc.save('informe-andorraos.pdf');
    });
  </script>

</body>
</html>
