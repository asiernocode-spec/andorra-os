<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>AndorraOS – Calculadora Fiscal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="page">
    <div class="page-inner">

      <section class="left">
        <div class="left-inner">

          <div class="logo-row">
            <div class="logo-main">
              <div class="logo-icon"><span>AO</span></div>
              <div class="logo-text">
                <div class="logo-title">ANDORRAOS</div>
                <div class="logo-subtitle">CALCULADORA FISCAL</div>
              </div>
            </div>
          </div>

          <div class="title-block">
            <div class="title-main">
              Simulación fiscal<br />
              <span>España vs Andorra</span>
            </div>
            <div class="title-sub">
              Introduce tus datos y obtén un análisis detallado.
            </div>
          </div>

          <form id="calc-form">

            <label>Ingresos anuales (€)</label>
            <input type="number" id="ingresos" required />

            <label>País actual</label>
            <select id="pais" required>
              <option value="espana">España</option>
              <option value="otro">Otro</option>
            </select>

            <label>Estructura</label>
            <select id="estructura" required>
              <option value="autonomo">Autónomo</option>
              <option value="empresa">Empresa</option>
            </select>

            <label>Parroquia en Andorra</label>
            <select id="parroquia" required>
              <option value="andorra-la-vella">Andorra la Vella</option>
              <option value="escaldes-engordany">Escaldes-Engordany</option>
              <option value="encamp">Encamp</option>
              <option value="la-massana">La Massana</option>
              <option value="ordino">Ordino</option>
              <option value="canillo">Canillo</option>
              <option value="sant-julia">Sant Julià de Lòria</option>
            </select>

            <label>Email</label>
            <input type="email" id="email" required />

            <button type="submit" class="btn-primary">
              <span class="icon">➜</span>
              <span>Calcular</span>
            </button>

          </form>

          <div id="resultados" class="resultados"></div>

          <button id="btn-pdf" class="btn-secondary" style="display:none;">
            Descargar informe PDF
          </button>

        </div>
      </section>

    </div>
  </div>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="sha512-V3ZCwH0z7LxyzKDn5XxhxL7sRKqzZo4PMBVXgS5aXoaZySUdkGFUTkOcJCIZy9FHn5Vf3L7hIwrKyYVJZZzqVg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    // Precargar email desde index.html
    const storedEmail = localStorage.getItem('andorraos_email');
    if (storedEmail) {
      document.getElementById('email').value = storedEmail;
    }

    // Cálculo fiscal
    document.getElementById('calc-form').addEventListener('submit', function(e) {
      e.preventDefault();

      const ingresos = parseFloat(document.getElementById('ingresos').value);
      const estructura = document.getElementById('estructura').value;

      let irpfEsp = ingresos * 0.30;
      let irpfAnd = ingresos <= 24000 ? 0 : (ingresos - 24000) * 0.05;

      const ahorro = irpfEsp - irpfAnd;

      document.getElementById('resultados').innerHTML = `
        <h3>Resultados</h3>
        <p><strong>IRPF España:</strong> ${irpfEsp.toFixed(2)} €</p>
        <p><strong>IRPF Andorra:</strong> ${irpfAnd.toFixed(2)} €</p>
        <p><strong>Ahorro estimado:</strong> ${ahorro.toFixed(2)} €</p>
      `;

      document.getElementById('btn-pdf').style.display = 'block';
    });

    // PDF PROFESIONAL
    document.getElementById('btn-pdf').addEventListener('click', () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const ingresos = document.getElementById('ingresos').value;
      const estructura = document.getElementById('estructura').value;
      const email = document.getElementById('email').value;
      const resultados = document.getElementById('resultados').innerText.split('\n');

      // ===== PORTADA =====
      doc.setFillColor(0, 0, 0);
      doc.rect(0, 0, 210, 297, "F");

      doc.setTextColor(255, 255, 255);
      doc.setFontSize(28);
      doc.text("ANDORRAOS", 20, 40);

      doc.setFontSize(18);
      doc.text("Informe Fiscal Personalizado", 20, 60);

      doc.setFontSize(12);
      doc.text("Comparativa España vs Andorra · 2026", 20, 75);

      doc.setFontSize(10);
      doc.text(`Generado para: ${email}`, 20, 90);

      doc.addPage();

      // ===== DATOS =====
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(20);
      doc.text("1. Datos del usuario", 10, 20);

      doc.setFontSize(12);
      doc.text(`Ingresos anuales: ${ingresos} €`, 10, 40);
      doc.text(`Estructura: ${estructura}`, 10, 50);
      doc.text(`Email: ${email}`, 10, 60);

      doc.addPage();

      // ===== RESULTADOS =====
      doc.setFontSize(20);
      doc.text("2. Resultados del análisis fiscal", 10, 20);

      doc.setFontSize(12);
      let y = 40;
      resultados.forEach(line => {
        doc.text(line, 10, y);
        y += 10;
      });

      doc.addPage();

      // ===== RECOMENDACIONES =====
      doc.setFontSize(20);
      doc.text("3. Recomendaciones personalizadas", 10, 20);

      doc.setFontSize(12);
      doc.text("Basado en tus ingresos y estructura actual, aquí tienes una valoración:", 10, 40);

      let ahorro = parseFloat(resultados[2].replace(/[^0-9.-]+/g,""));
      let recomendacion = "";

      if (ahorro > 15000) {
        recomendacion = "Tu ahorro potencial es muy alto. Andorra es una opción fiscalmente muy ventajosa para tu perfil.";
      } else if (ahorro > 5000) {
        recomendacion = "Tu ahorro es significativo. Puede valer la pena evaluar un cambio de residencia fiscal.";
      } else {
        recomendacion = "Tu ahorro no es muy elevado. Andorra puede ser interesante, pero no es una ventaja tan grande.";
      }

      doc.text(recomendacion, 10, 55, { maxWidth: 180 });

      doc.addPage();

      // ===== CONCLUSIÓN =====
      doc.setFontSize(20);
      doc.text("4. Conclusión", 10, 20);

      doc.setFontSize(12);
      doc.text(
        "Este informe ha sido generado automáticamente por AndorraOS. " +
        "Los cálculos son aproximados y se basan en los tramos fiscales vigentes en 2026. " +
        "Para un análisis profesional completo, recomendamos consultar con un asesor fiscal especializado.",
        10,
        40,
        { maxWidth: 180 }
      );

      doc.save("informe-andorraos.pdf");
    });
  </script>

</body>
</html>
